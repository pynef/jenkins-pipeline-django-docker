pipeline {
    agent any
    options {
        ansiColor('xterm')
        timestamps()
        timeout(time: 1, unit: 'HOURS')
    }
    environment {
        ARTIFACTOR = "${env.BUILD_NUMBER}.zip"
    }

    stages {
        stage("Repository") {
            steps {
              checkout scm
            }
        }
        stage("Build") {
            steps {
              echo "build"
              sh "zip -r ${ARTIFACTOR} ./"
              sh "docker build -t mymeetup:${env.BUILD_NUMBER} ."
              sh "docker tag mymeetup:${env.BUILD_NUMBER} mymeetup:latest"
            }
        }
        stage("Test") {
           steps {
             parallel (
               syntax: { sh "echo syntax" },
               grep: { sh "echo 'grep'" }
             )
           }
        }

    }
    post {
      always {
        archiveArtifacts artifacts: "${ARTIFACTOR}", onlyIfSuccessful: true
        sh "rm -f ${ARTIFACTOR}"
        echo "Job has finished"
      }
    }
}
